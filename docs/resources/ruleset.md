---
page_title: "cloudflare_ruleset Resource - Cloudflare"
subcategory: ""
description: |-
  
---

# cloudflare_ruleset (Resource)



## Example Usage

```terraform
resource "cloudflare_ruleset" "example_ruleset" {
  kind = "managed"
  name = "My ruleset"
  phase = "ddos_l4"
  zone_id = "zone_id"
  description = "My ruleset to execute managed rulesets"
  rules = [{
    id = "3a03d665bac047339bb530ecb439a90d"
    action = "block"
    action_parameters = {
      response = {
        content = <<EOT
        {
          "success": false,
          "error": "you have been blocked"
        }
        EOT
        content_type = "application/json"
        status_code = 400
      }
    }
    description = "Block when the IP address is not 1.1.1.1"
    enabled = true
    exposed_credential_check = {
      password_expression = "url_decode(http.request.body.form[\\\"password\\\"][0])"
      username_expression = "url_decode(http.request.body.form[\\\"username\\\"][0])"
    }
    expression = "ip.src ne 1.1.1.1"
    logging = {
      enabled = true
    }
    ratelimit = {
      characteristics = ["ip.src"]
      period = 10
      counting_expression = "http.request.body.raw eq \"abcd\""
      mitigation_timeout = 600
      requests_per_period = 1000
      requests_to_origin = true
      score_per_period = 400
      score_response_header_name = "my-score"
    }
    ref = "my_ref"
  }]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `kind` (String) The kind of the ruleset.
- `name` (String) The human-readable name of the ruleset.
- `phase` (String) The phase of the ruleset.

### Optional

- `account_id` (String) The Account ID to use for this endpoint. Mutually exclusive with the Zone ID.
- `description` (String) An informative description of the ruleset.
- `rules` (Attributes List) The list of rules in the ruleset. (see [below for nested schema](#nestedatt--rules))
- `zone_id` (String) The Zone ID to use for this endpoint. Mutually exclusive with the Account ID.

### Read-Only

- `id` (String) The unique ID of the ruleset.

<a id="nestedatt--rules"></a>
### Nested Schema for `rules`

Optional:

- `action` (String) The action to perform when the rule matches.
- `action_parameters` (Attributes) The parameters configuring the rule's action. (see [below for nested schema](#nestedatt--rules--action_parameters))
- `description` (String) An informative description of the rule.
- `enabled` (Boolean) Whether the rule should be executed.
- `exposed_credential_check` (Attributes) Configure checks for exposed credentials. (see [below for nested schema](#nestedatt--rules--exposed_credential_check))
- `expression` (String) The expression defining which traffic will match the rule.
- `logging` (Attributes) An object configuring the rule's logging behavior. (see [below for nested schema](#nestedatt--rules--logging))
- `ratelimit` (Attributes) An object configuring the rule's ratelimit behavior. (see [below for nested schema](#nestedatt--rules--ratelimit))
- `ref` (String) The reference of the rule (the rule ID by default).

Read-Only:

- `categories` (List of String) The categories of the rule.
- `id` (String) The unique ID of the rule.

<a id="nestedatt--rules--action_parameters"></a>
### Nested Schema for `rules.action_parameters`

Optional:

- `additional_cacheable_ports` (List of Number) List of additional ports that caching can be enabled on.
- `algorithms` (Attributes List) Custom order for compression algorithms. (see [below for nested schema](#nestedatt--rules--action_parameters--algorithms))
- `automatic_https_rewrites` (Boolean) Turn on or off Automatic HTTPS Rewrites.
- `autominify` (Attributes) Select which file extensions to minify automatically. (see [below for nested schema](#nestedatt--rules--action_parameters--autominify))
- `bic` (Boolean) Turn on or off Browser Integrity Check.
- `browser_ttl` (Attributes) Specify how long client browsers should cache the response. Cloudflare cache purge will not purge content cached on client browsers, so high browser TTLs may lead to stale content. (see [below for nested schema](#nestedatt--rules--action_parameters--browser_ttl))
- `cache` (Boolean) Mark whether the request’s response from origin is eligible for caching. Caching itself will still depend on the cache-control header and your other caching configurations.
- `cache_key` (Attributes) Define which components of the request are included or excluded from the cache key Cloudflare uses to store the response in cache. (see [below for nested schema](#nestedatt--rules--action_parameters--cache_key))
- `cache_reserve` (Attributes) Mark whether the request's response from origin is eligible for Cache Reserve (requires a Cache Reserve add-on plan). (see [below for nested schema](#nestedatt--rules--action_parameters--cache_reserve))
- `content` (String) Error response content.
- `content_type` (String) Content-type header to set with the response.
- `cookie_fields` (Attributes List) The cookie fields to log. (see [below for nested schema](#nestedatt--rules--action_parameters--cookie_fields))
- `disable_apps` (Boolean) Turn off all active Cloudflare Apps.
- `disable_rum` (Boolean) Turn off Real User Monitoring (RUM).
- `disable_zaraz` (Boolean) Turn off Zaraz.
- `edge_ttl` (Attributes) TTL (Time to Live) specifies the maximum time to cache a resource in the Cloudflare edge network. (see [below for nested schema](#nestedatt--rules--action_parameters--edge_ttl))
- `email_obfuscation` (Boolean) Turn on or off Email Obfuscation.
- `fonts` (Boolean) Turn on or off Cloudflare Fonts.
- `from_list` (Attributes) Serve a redirect based on a bulk list lookup. (see [below for nested schema](#nestedatt--rules--action_parameters--from_list))
- `from_value` (Attributes) Serve a redirect based on the request properties. (see [below for nested schema](#nestedatt--rules--action_parameters--from_value))
- `headers` (Attributes Map) Map of request headers to modify. (see [below for nested schema](#nestedatt--rules--action_parameters--headers))
- `host_header` (String) Rewrite the HTTP Host header.
- `hotlink_protection` (Boolean) Turn on or off the Hotlink Protection.
- `id` (String) The ID of the ruleset to execute.
- `increment` (Number) Increment contains the delta to change the score and can be either positive or negative.
- `matched_data` (Attributes) The configuration to use for matched data logging. (see [below for nested schema](#nestedatt--rules--action_parameters--matched_data))
- `mirage` (Boolean) Turn on or off Mirage.
- `opportunistic_encryption` (Boolean) Turn on or off Opportunistic Encryption.
- `origin` (Attributes) Override the IP/TCP destination. (see [below for nested schema](#nestedatt--rules--action_parameters--origin))
- `origin_cache_control` (Boolean) When enabled, Cloudflare will aim to strictly adhere to RFC 7234.
- `origin_error_page_passthru` (Boolean) Generate Cloudflare error pages from issues sent from the origin server. When on, error pages will trigger for issues from the origin
- `overrides` (Attributes) A set of overrides to apply to the target ruleset. (see [below for nested schema](#nestedatt--rules--action_parameters--overrides))
- `phases` (List of String) A list of phases to skip the execution of. This option is incompatible with the ruleset and rulesets options.
- `polish` (String) Configure the Polish level.
- `products` (List of String) A list of legacy security products to skip the execution of.
- `read_timeout` (Number) Define a timeout value between two successive read operations to your origin server. Historically, the timeout value between two read options from Cloudflare to an origin server is 100 seconds. If you are attempting to reduce HTTP 524 errors because of timeouts from an origin server, try increasing this timeout value.
- `request_fields` (Attributes List) The request fields to log. (see [below for nested schema](#nestedatt--rules--action_parameters--request_fields))
- `respect_strong_etags` (Boolean) Specify whether or not Cloudflare should respect strong ETag (entity tag) headers. When off, Cloudflare converts strong ETag headers to weak ETag headers.
- `response` (Attributes) The response to show when the block is applied. (see [below for nested schema](#nestedatt--rules--action_parameters--response))
- `response_fields` (Attributes List) The response fields to log. (see [below for nested schema](#nestedatt--rules--action_parameters--response_fields))
- `rocket_loader` (Boolean) Turn on or off Rocket Loader
- `rules` (Map of List of String) A mapping of ruleset IDs to a list of rule IDs in that ruleset to skip the execution of. This option is incompatible with the ruleset option.
- `ruleset` (String) A ruleset to skip the execution of. This option is incompatible with the rulesets, rules and phases options.
- `rulesets` (List of String) A list of ruleset IDs to skip the execution of. This option is incompatible with the ruleset and phases options.
- `security_level` (String) Configure the Security Level.
- `serve_stale` (Attributes) Define if Cloudflare should serve stale content while getting the latest content from the origin. If on, Cloudflare will not serve stale content while getting the latest content from the origin. (see [below for nested schema](#nestedatt--rules--action_parameters--serve_stale))
- `server_side_excludes` (Boolean) Turn on or off Server Side Excludes.
- `sni` (Attributes) Override the Server Name Indication (SNI). (see [below for nested schema](#nestedatt--rules--action_parameters--sni))
- `ssl` (String) Configure the SSL level.
- `status_code` (Number) The status code to use for the error.
- `sxg` (Boolean) Turn on or off Signed Exchanges (SXG).
- `uri` (Attributes) URI to rewrite the request to. (see [below for nested schema](#nestedatt--rules--action_parameters--uri))

<a id="nestedatt--rules--action_parameters--algorithms"></a>
### Nested Schema for `rules.action_parameters.algorithms`

Optional:

- `name` (String) Name of compression algorithm to enable.


<a id="nestedatt--rules--action_parameters--autominify"></a>
### Nested Schema for `rules.action_parameters.autominify`

Optional:

- `css` (Boolean) Minify CSS files.
- `html` (Boolean) Minify HTML files.
- `js` (Boolean) Minify JS files.


<a id="nestedatt--rules--action_parameters--browser_ttl"></a>
### Nested Schema for `rules.action_parameters.browser_ttl`

Required:

- `mode` (String) Determines which browser ttl mode to use.

Optional:

- `default` (Number) The TTL (in seconds) if you choose override_origin mode.


<a id="nestedatt--rules--action_parameters--cache_key"></a>
### Nested Schema for `rules.action_parameters.cache_key`

Optional:

- `cache_by_device_type` (Boolean) Separate cached content based on the visitor’s device type
- `cache_deception_armor` (Boolean) Protect from web cache deception attacks while allowing static assets to be cached
- `custom_key` (Attributes) Customize which components of the request are included or excluded from the cache key. (see [below for nested schema](#nestedatt--rules--action_parameters--cache_key--custom_key))
- `ignore_query_strings_order` (Boolean) Treat requests with the same query parameters the same, regardless of the order those query parameters are in. A value of true ignores the query strings' order.

<a id="nestedatt--rules--action_parameters--cache_key--custom_key"></a>
### Nested Schema for `rules.action_parameters.cache_key.custom_key`

Optional:

- `cookie` (Attributes) The cookies to include in building the cache key. (see [below for nested schema](#nestedatt--rules--action_parameters--cache_key--custom_key--cookie))
- `header` (Attributes) The header names and values to include in building the cache key. (see [below for nested schema](#nestedatt--rules--action_parameters--cache_key--custom_key--header))
- `host` (Attributes) Whether to use the original host or the resolved host in the cache key. (see [below for nested schema](#nestedatt--rules--action_parameters--cache_key--custom_key--host))
- `query_string` (Attributes) Use the presence of parameters in the query string to build the cache key. (see [below for nested schema](#nestedatt--rules--action_parameters--cache_key--custom_key--query_string))
- `user` (Attributes) Characteristics of the request user agent used in building the cache key. (see [below for nested schema](#nestedatt--rules--action_parameters--cache_key--custom_key--user))

<a id="nestedatt--rules--action_parameters--cache_key--custom_key--cookie"></a>
### Nested Schema for `rules.action_parameters.cache_key.custom_key.cookie`

Optional:

- `check_presence` (List of String) Checks for the presence of these cookie names. The presence of these cookies is used in building the cache key.
- `include` (List of String) Include these cookies' names and their values.


<a id="nestedatt--rules--action_parameters--cache_key--custom_key--header"></a>
### Nested Schema for `rules.action_parameters.cache_key.custom_key.header`

Optional:

- `check_presence` (List of String) Checks for the presence of these header names. The presence of these headers is used in building the cache key.
- `contains` (Map of List of String) For each header name and list of values combination, check if the request header contains any of the values provided. The presence of the request header and whether any of the values provided are contained in the request header value is used in building the cache key.
- `exclude_origin` (Boolean) Whether or not to include the origin header. A value of true will exclude the origin header in the cache key.
- `include` (List of String) Include these headers' names and their values.


<a id="nestedatt--rules--action_parameters--cache_key--custom_key--host"></a>
### Nested Schema for `rules.action_parameters.cache_key.custom_key.host`

Optional:

- `resolved` (Boolean) Use the resolved host in the cache key. A value of true will use the resolved host, while a value or false will use the original host.


<a id="nestedatt--rules--action_parameters--cache_key--custom_key--query_string"></a>
### Nested Schema for `rules.action_parameters.cache_key.custom_key.query_string`

Optional:

- `exclude` (Attributes) A list of query string parameters NOT used to build the cache key. All parameters present in the request but missing in this list will be used to build the cache key. (see [below for nested schema](#nestedatt--rules--action_parameters--cache_key--custom_key--query_string--exclude))
- `include` (Attributes) A list of query string parameters used to build the cache key. (see [below for nested schema](#nestedatt--rules--action_parameters--cache_key--custom_key--query_string--include))

<a id="nestedatt--rules--action_parameters--cache_key--custom_key--query_string--exclude"></a>
### Nested Schema for `rules.action_parameters.cache_key.custom_key.query_string.exclude`

Optional:

- `all` (Boolean) Determines whether to exclude all query string parameters from the cache key.
- `list` (List of String)


<a id="nestedatt--rules--action_parameters--cache_key--custom_key--query_string--include"></a>
### Nested Schema for `rules.action_parameters.cache_key.custom_key.query_string.include`

Optional:

- `all` (Boolean) Determines whether to include all query string parameters in the cache key.
- `list` (List of String)



<a id="nestedatt--rules--action_parameters--cache_key--custom_key--user"></a>
### Nested Schema for `rules.action_parameters.cache_key.custom_key.user`

Optional:

- `device_type` (Boolean) Use the user agent's device type in the cache key.
- `geo` (Boolean) Use the user agents's country in the cache key.
- `lang` (Boolean) Use the user agent's language in the cache key.




<a id="nestedatt--rules--action_parameters--cache_reserve"></a>
### Nested Schema for `rules.action_parameters.cache_reserve`

Required:

- `eligible` (Boolean) Determines whether cache reserve is enabled. If this is true and a request meets eligibility criteria, Cloudflare will write the resource to cache reserve.
- `minimum_file_size` (Number) The minimum file size eligible for store in cache reserve.


<a id="nestedatt--rules--action_parameters--cookie_fields"></a>
### Nested Schema for `rules.action_parameters.cookie_fields`

Required:

- `name` (String) The name of the field.


<a id="nestedatt--rules--action_parameters--edge_ttl"></a>
### Nested Schema for `rules.action_parameters.edge_ttl`

Required:

- `mode` (String) edge ttl options

Optional:

- `default` (Number) The TTL (in seconds) if you choose override_origin mode.
- `status_code_ttl` (Attributes List) List of single status codes, or status code ranges to apply the selected mode (see [below for nested schema](#nestedatt--rules--action_parameters--edge_ttl--status_code_ttl))

<a id="nestedatt--rules--action_parameters--edge_ttl--status_code_ttl"></a>
### Nested Schema for `rules.action_parameters.edge_ttl.status_code_ttl`

Required:

- `value` (Number) Time to cache a response (in seconds). A value of 0 is equivalent to setting the Cache-Control header with the value "no-cache". A value of -1 is equivalent to setting Cache-Control header with the value of "no-store".

Optional:

- `status_code` (Number) Set the ttl for responses with this specific status code
- `status_code_range` (Attributes) The range of status codes used to apply the selected mode. (see [below for nested schema](#nestedatt--rules--action_parameters--edge_ttl--status_code_ttl--status_code_range))

<a id="nestedatt--rules--action_parameters--edge_ttl--status_code_ttl--status_code_range"></a>
### Nested Schema for `rules.action_parameters.edge_ttl.status_code_ttl.status_code_range`

Optional:

- `from` (Number) response status code lower bound
- `to` (Number) response status code upper bound




<a id="nestedatt--rules--action_parameters--from_list"></a>
### Nested Schema for `rules.action_parameters.from_list`

Optional:

- `key` (String) Expression that evaluates to the list lookup key.
- `name` (String) The name of the list to match against.


<a id="nestedatt--rules--action_parameters--from_value"></a>
### Nested Schema for `rules.action_parameters.from_value`

Optional:

- `preserve_query_string` (Boolean) Keep the query string of the original request.
- `status_code` (Number) The status code to be used for the redirect.
- `target_url` (Attributes) The URL to redirect the request to. (see [below for nested schema](#nestedatt--rules--action_parameters--from_value--target_url))

<a id="nestedatt--rules--action_parameters--from_value--target_url"></a>
### Nested Schema for `rules.action_parameters.from_value.target_url`

Optional:

- `expression` (String) An expression to evaluate to get the URL to redirect the request to.
- `value` (String) The URL to redirect the request to.



<a id="nestedatt--rules--action_parameters--headers"></a>
### Nested Schema for `rules.action_parameters.headers`

Required:

- `operation` (String)

Optional:

- `expression` (String) Expression for the header value.
- `value` (String) Static value for the header.


<a id="nestedatt--rules--action_parameters--matched_data"></a>
### Nested Schema for `rules.action_parameters.matched_data`

Required:

- `public_key` (String) The public key to encrypt matched data logs with.


<a id="nestedatt--rules--action_parameters--origin"></a>
### Nested Schema for `rules.action_parameters.origin`

Optional:

- `host` (String) Override the resolved hostname.
- `port` (Number) Override the destination port.


<a id="nestedatt--rules--action_parameters--overrides"></a>
### Nested Schema for `rules.action_parameters.overrides`

Optional:

- `action` (String) An action to override all rules with. This option has lower precedence than rule and category overrides.
- `categories` (Attributes List) A list of category-level overrides. This option has the second-highest precedence after rule-level overrides. (see [below for nested schema](#nestedatt--rules--action_parameters--overrides--categories))
- `enabled` (Boolean) Whether to enable execution of all rules. This option has lower precedence than rule and category overrides.
- `rules` (Attributes List) A list of rule-level overrides. This option has the highest precedence. (see [below for nested schema](#nestedatt--rules--action_parameters--overrides--rules))
- `sensitivity_level` (String) A sensitivity level to set for all rules. This option has lower precedence than rule and category overrides and is only applicable for DDoS phases.

<a id="nestedatt--rules--action_parameters--overrides--categories"></a>
### Nested Schema for `rules.action_parameters.overrides.categories`

Required:

- `category` (String) The name of the category to override.

Optional:

- `action` (String) The action to override rules in the category with.
- `enabled` (Boolean) Whether to enable execution of rules in the category.
- `sensitivity_level` (String) The sensitivity level to use for rules in the category.


<a id="nestedatt--rules--action_parameters--overrides--rules"></a>
### Nested Schema for `rules.action_parameters.overrides.rules`

Required:

- `id` (String) The ID of the rule to override.

Optional:

- `action` (String) The action to override the rule with.
- `enabled` (Boolean) Whether to enable execution of the rule.
- `score_threshold` (Number) The score threshold to use for the rule.
- `sensitivity_level` (String) The sensitivity level to use for the rule.



<a id="nestedatt--rules--action_parameters--request_fields"></a>
### Nested Schema for `rules.action_parameters.request_fields`

Required:

- `name` (String) The name of the field.


<a id="nestedatt--rules--action_parameters--response"></a>
### Nested Schema for `rules.action_parameters.response`

Required:

- `content` (String) The content to return.
- `content_type` (String) The type of the content to return.
- `status_code` (Number) The status code to return.


<a id="nestedatt--rules--action_parameters--response_fields"></a>
### Nested Schema for `rules.action_parameters.response_fields`

Required:

- `name` (String) The name of the field.


<a id="nestedatt--rules--action_parameters--serve_stale"></a>
### Nested Schema for `rules.action_parameters.serve_stale`

Required:

- `disable_stale_while_updating` (Boolean) Defines whether Cloudflare should serve stale content while updating. If true, Cloudflare will not serve stale content while getting the latest content from the origin.


<a id="nestedatt--rules--action_parameters--sni"></a>
### Nested Schema for `rules.action_parameters.sni`

Required:

- `value` (String) The SNI override.


<a id="nestedatt--rules--action_parameters--uri"></a>
### Nested Schema for `rules.action_parameters.uri`

Optional:

- `path` (Attributes) Path portion rewrite. (see [below for nested schema](#nestedatt--rules--action_parameters--uri--path))
- `query` (Attributes) Query portion rewrite. (see [below for nested schema](#nestedatt--rules--action_parameters--uri--query))

<a id="nestedatt--rules--action_parameters--uri--path"></a>
### Nested Schema for `rules.action_parameters.uri.path`

Optional:

- `expression` (String) Expression to evaluate for the replacement value.
- `value` (String) Predefined replacement value.


<a id="nestedatt--rules--action_parameters--uri--query"></a>
### Nested Schema for `rules.action_parameters.uri.query`

Optional:

- `expression` (String) Expression to evaluate for the replacement value.
- `value` (String) Predefined replacement value.




<a id="nestedatt--rules--exposed_credential_check"></a>
### Nested Schema for `rules.exposed_credential_check`

Required:

- `password_expression` (String) Expression that selects the password used in the credentials check.
- `username_expression` (String) Expression that selects the user ID used in the credentials check.


<a id="nestedatt--rules--logging"></a>
### Nested Schema for `rules.logging`

Required:

- `enabled` (Boolean) Whether to generate a log when the rule matches.


<a id="nestedatt--rules--ratelimit"></a>
### Nested Schema for `rules.ratelimit`

Required:

- `characteristics` (List of String) Characteristics of the request on which the ratelimiter counter will be incremented.
- `period` (Number) Period in seconds over which the counter is being incremented.

Optional:

- `counting_expression` (String) Defines when the ratelimit counter should be incremented. It is optional and defaults to the same as the rule's expression.
- `mitigation_timeout` (Number) Period of time in seconds after which the action will be disabled following its first execution.
- `requests_per_period` (Number) The threshold of requests per period after which the action will be executed for the first time.
- `requests_to_origin` (Boolean) Defines if ratelimit counting is only done when an origin is reached.
- `score_per_period` (Number) The score threshold per period for which the action will be executed the first time.
- `score_response_header_name` (String) The response header name provided by the origin which should contain the score to increment ratelimit counter on.

## Import

Import is supported using the following syntax:

```shell
$ terraform import cloudflare_ruleset.example '<{accounts|zones}/{account_id|zone_id}>/<ruleset_id>'
```
