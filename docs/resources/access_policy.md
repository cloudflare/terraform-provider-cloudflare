---
page_title: "cloudflare_access_policy Resource - Cloudflare"
subcategory: ""
description: |-
  Provides a Cloudflare Access Policy resource. Access Policies are
  used in conjunction with Access Applications to restrict access to
  a particular resource.
---

# cloudflare_access_policy (Resource)

Provides a Cloudflare Access Policy resource. Access Policies are
used in conjunction with Access Applications to restrict access to
a particular resource.

~> It's required that an `account_id` or `zone_id` is provided and in most cases using either is fine.
   However, if you're using a scoped access token, you must provide the argument that matches the token's
   scope. For example, an access token that is scoped to the "example.com" zone needs to use the `zone_id` argument.
   If 'application_id' is omitted, the policy created can be reused by multiple access applications.
   Any cloudflare_access_application resource can reference reusable policies through its `policies` argument.
   To destroy a reusable policy and remove it from all applications' policies lists on the same apply, preemptively set the
   lifecycle option `create_before_destroy` to true on the 'cloudflare_access_policy' resource.

## Example Usage

```terraform
# Allowing access to `test@example.com` email address only
resource "cloudflare_access_policy" "test_policy" {
  account_id = "f037e56e89293a057740de681ac9abbe"
  name       = "staging policy"
  decision   = "allow"

  include {
    email = ["test@example.com"]
  }

  require {
    email = ["test@example.com"]
  }
}

# Allowing `test@example.com` to access but only when coming from a
# specific IP.
resource "cloudflare_access_policy" "test_policy" {
  account_id = "f037e56e89293a057740de681ac9abbe"
  name       = "staging policy"
  decision   = "allow"

  include {
    email = ["test@example.com"]
  }

  require {
    ip = [var.office_ip]
  }
}

# Access policy for an infrastructure application
resource "cloudflare_access_policy" "infra-app-example-allow" {
  application_id = cloudflare_zero_trust_access_application.infra-app-example.id
  account_id     = "f037e56e89293a057740de681ac9abbe"
  name           = "infra-app-example-allow"
  decision       = "allow"
  precedence     = 1

  include {
    email = ["devuser@gmail.com"]
  }

  connection_rules {
    ssh {
      usernames = ["ec2-user"]
      allow_email_alias = true
    }
  }
}

# Infrastructure application configuration for infra-app-example-allow
resource "cloudflare_zero_trust_access_application" "infra-app-example" {
  account_id = "f037e56e89293a057740de681ac9abbe"
  name       = "infra-app"
  type       = "infrastructure"

  target_criteria {
    port     = 22
    protocol = "SSH"
    target_attributes {
      name   = "hostname"
      values = ["tfgo-tests-useast", "tfgo-tests-uswest"]
    }
  }

  # specify existing access policies by id
  policies = []
}
```
<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `decision` (String) Defines the action Access will take if the policy matches the user. Available values: `allow`, `deny`, `non_identity`, `bypass`.
- `include` (Block List, Min: 1) A series of access conditions, see [Access Groups](https://registry.terraform.io/providers/cloudflare/cloudflare/latest/docs/resources/access_group#conditions). (see [below for nested schema](#nestedblock--include))
- `name` (String) Friendly name of the Access Policy.

### Optional

- `account_id` (String) The account identifier to target for the resource. Conflicts with `zone_id`.
- `application_id` (String) The ID of the application the policy is associated with. Required when using `precedence`. **Modifying this attribute will force creation of a new resource.**
- `approval_group` (Block List) (see [below for nested schema](#nestedblock--approval_group))
- `approval_required` (Boolean)
- `connection_rules` (Block List, Max: 1) The rules that define how users may connect to the targets secured by your application. Only applicable to Infrastructure Applications, in which case this field is required. (see [below for nested schema](#nestedblock--connection_rules))
- `exclude` (Block List) A series of access conditions, see [Access Groups](https://registry.terraform.io/providers/cloudflare/cloudflare/latest/docs/resources/access_group#conditions). (see [below for nested schema](#nestedblock--exclude))
- `isolation_required` (Boolean) Require this application to be served in an isolated browser for users matching this policy.
- `precedence` (Number) The unique precedence for policies on a single application. Required when using `application_id`.
- `purpose_justification_prompt` (String) The prompt to display to the user for a justification for accessing the resource. Required when using `purpose_justification_required`.
- `purpose_justification_required` (Boolean) Whether to prompt the user for a justification for accessing the resource.
- `require` (Block List) A series of access conditions, see [Access Groups](https://registry.terraform.io/providers/cloudflare/cloudflare/latest/docs/resources/access_group#conditions). (see [below for nested schema](#nestedblock--require))
- `session_duration` (String) How often a user will be forced to re-authorise. Must be in the format `48h` or `2h45m`.
- `zone_id` (String) The zone identifier to target for the resource. Conflicts with `account_id`.

### Read-Only

- `id` (String) The ID of this resource.

<a id="nestedblock--include"></a>
### Nested Schema for `include`

Optional:

- `any_valid_service_token` (Boolean) Matches any valid Access service token.
- `auth_context` (Block List) (see [below for nested schema](#nestedblock--include--auth_context))
- `auth_method` (String) The type of authentication method. Refer to https://datatracker.ietf.org/doc/html/rfc8176#section-2 for possible types.
- `azure` (Block List) Matches an Azure group. Requires an Azure identity provider. (see [below for nested schema](#nestedblock--include--azure))
- `certificate` (Boolean) Matches any valid client certificate.
- `common_name` (String) Matches a valid client certificate common name.
- `common_names` (List of String) Overflow field if you need to have multiple common_name rules in a single policy.  Use in place of the singular common_name field.
- `device_posture` (List of String) The ID of a device posture integration.
- `email` (List of String) The email of the user.
- `email_domain` (List of String) The email domain to match.
- `email_list` (List of String) The ID of a previously created email list.
- `everyone` (Boolean) Matches everyone.
- `external_evaluation` (Block List) Create Allow or Block policies which evaluate the user based on custom criteria. https://developers.cloudflare.com/cloudflare-one/policies/access/external-evaluation/. (see [below for nested schema](#nestedblock--include--external_evaluation))
- `geo` (List of String) Matches a specific country.
- `github` (Block List) Matches a Github organization. Requires a Github identity provider. (see [below for nested schema](#nestedblock--include--github))
- `group` (List of String) The ID of a previously created Access group.
- `gsuite` (Block List) Matches a group in Google Workspace. Requires a Google Workspace identity provider. (see [below for nested schema](#nestedblock--include--gsuite))
- `ip` (List of String) An IPv4 or IPv6 CIDR block.
- `ip_list` (List of String) The ID of a previously created IP list.
- `login_method` (List of String) The ID of a configured identity provider.
- `okta` (Block List) Matches an Okta group. Requires an Okta identity provider. (see [below for nested schema](#nestedblock--include--okta))
- `saml` (Block List) Matches a SAML group. Requires a SAML identity provider. (see [below for nested schema](#nestedblock--include--saml))
- `service_token` (List of String) The ID of an Access service token.

<a id="nestedblock--include--auth_context"></a>
### Nested Schema for `include.auth_context`

Required:

- `ac_id` (String) The ACID of the Authentication Context.
- `id` (String) The ID of the Authentication Context.
- `identity_provider_id` (String) The ID of the Azure identity provider.


<a id="nestedblock--include--azure"></a>
### Nested Schema for `include.azure`

Optional:

- `id` (List of String) The ID of the Azure group or user.
- `identity_provider_id` (String) The ID of the Azure identity provider.


<a id="nestedblock--include--external_evaluation"></a>
### Nested Schema for `include.external_evaluation`

Optional:

- `evaluate_url` (String) The API endpoint containing your business logic.
- `keys_url` (String) The API endpoint containing the key that Access uses to verify that the response came from your API.


<a id="nestedblock--include--github"></a>
### Nested Schema for `include.github`

Optional:

- `identity_provider_id` (String) The ID of your Github identity provider.
- `name` (String) The name of the organization.
- `teams` (List of String) The teams that should be matched.


<a id="nestedblock--include--gsuite"></a>
### Nested Schema for `include.gsuite`

Required:

- `email` (List of String) The email of the Google Workspace group.
- `identity_provider_id` (String) The ID of your Google Workspace identity provider.


<a id="nestedblock--include--okta"></a>
### Nested Schema for `include.okta`

Optional:

- `identity_provider_id` (String) The ID of your Okta identity provider.
- `name` (List of String) The name of the Okta Group.


<a id="nestedblock--include--saml"></a>
### Nested Schema for `include.saml`

Optional:

- `attribute_name` (String) The name of the SAML attribute.
- `attribute_value` (String) The SAML attribute value to look for.
- `identity_provider_id` (String) The ID of your SAML identity provider.



<a id="nestedblock--approval_group"></a>
### Nested Schema for `approval_group`

Required:

- `approvals_needed` (Number) Number of approvals needed.

Optional:

- `email_addresses` (List of String) List of emails to request approval from.
- `email_list_uuid` (String)


<a id="nestedblock--connection_rules"></a>
### Nested Schema for `connection_rules`

Required:

- `ssh` (Block List, Min: 1, Max: 1) The SSH-specific rules that define how users may connect to the targets secured by your application. (see [below for nested schema](#nestedblock--connection_rules--ssh))

<a id="nestedblock--connection_rules--ssh"></a>
### Nested Schema for `connection_rules.ssh`

Required:

- `usernames` (List of String) Contains the Unix usernames that may be used when connecting over SSH.

Optional:

- `allow_email_alias` (Boolean) Allows connecting to Unix username that matches the authenticating email prefix.



<a id="nestedblock--exclude"></a>
### Nested Schema for `exclude`

Optional:

- `any_valid_service_token` (Boolean) Matches any valid Access service token.
- `auth_context` (Block List) (see [below for nested schema](#nestedblock--exclude--auth_context))
- `auth_method` (String) The type of authentication method. Refer to https://datatracker.ietf.org/doc/html/rfc8176#section-2 for possible types.
- `azure` (Block List) Matches an Azure group. Requires an Azure identity provider. (see [below for nested schema](#nestedblock--exclude--azure))
- `certificate` (Boolean) Matches any valid client certificate.
- `common_name` (String) Matches a valid client certificate common name.
- `common_names` (List of String) Overflow field if you need to have multiple common_name rules in a single policy.  Use in place of the singular common_name field.
- `device_posture` (List of String) The ID of a device posture integration.
- `email` (List of String) The email of the user.
- `email_domain` (List of String) The email domain to match.
- `email_list` (List of String) The ID of a previously created email list.
- `everyone` (Boolean) Matches everyone.
- `external_evaluation` (Block List) Create Allow or Block policies which evaluate the user based on custom criteria. https://developers.cloudflare.com/cloudflare-one/policies/access/external-evaluation/. (see [below for nested schema](#nestedblock--exclude--external_evaluation))
- `geo` (List of String) Matches a specific country.
- `github` (Block List) Matches a Github organization. Requires a Github identity provider. (see [below for nested schema](#nestedblock--exclude--github))
- `group` (List of String) The ID of a previously created Access group.
- `gsuite` (Block List) Matches a group in Google Workspace. Requires a Google Workspace identity provider. (see [below for nested schema](#nestedblock--exclude--gsuite))
- `ip` (List of String) An IPv4 or IPv6 CIDR block.
- `ip_list` (List of String) The ID of a previously created IP list.
- `login_method` (List of String) The ID of a configured identity provider.
- `okta` (Block List) Matches an Okta group. Requires an Okta identity provider. (see [below for nested schema](#nestedblock--exclude--okta))
- `saml` (Block List) Matches a SAML group. Requires a SAML identity provider. (see [below for nested schema](#nestedblock--exclude--saml))
- `service_token` (List of String) The ID of an Access service token.

<a id="nestedblock--exclude--auth_context"></a>
### Nested Schema for `exclude.auth_context`

Required:

- `ac_id` (String) The ACID of the Authentication Context.
- `id` (String) The ID of the Authentication Context.
- `identity_provider_id` (String) The ID of the Azure identity provider.


<a id="nestedblock--exclude--azure"></a>
### Nested Schema for `exclude.azure`

Optional:

- `id` (List of String) The ID of the Azure group or user.
- `identity_provider_id` (String) The ID of the Azure identity provider.


<a id="nestedblock--exclude--external_evaluation"></a>
### Nested Schema for `exclude.external_evaluation`

Optional:

- `evaluate_url` (String) The API endpoint containing your business logic.
- `keys_url` (String) The API endpoint containing the key that Access uses to verify that the response came from your API.


<a id="nestedblock--exclude--github"></a>
### Nested Schema for `exclude.github`

Optional:

- `identity_provider_id` (String) The ID of your Github identity provider.
- `name` (String) The name of the organization.
- `teams` (List of String) The teams that should be matched.


<a id="nestedblock--exclude--gsuite"></a>
### Nested Schema for `exclude.gsuite`

Required:

- `email` (List of String) The email of the Google Workspace group.
- `identity_provider_id` (String) The ID of your Google Workspace identity provider.


<a id="nestedblock--exclude--okta"></a>
### Nested Schema for `exclude.okta`

Optional:

- `identity_provider_id` (String) The ID of your Okta identity provider.
- `name` (List of String) The name of the Okta Group.


<a id="nestedblock--exclude--saml"></a>
### Nested Schema for `exclude.saml`

Optional:

- `attribute_name` (String) The name of the SAML attribute.
- `attribute_value` (String) The SAML attribute value to look for.
- `identity_provider_id` (String) The ID of your SAML identity provider.



<a id="nestedblock--require"></a>
### Nested Schema for `require`

Optional:

- `any_valid_service_token` (Boolean) Matches any valid Access service token.
- `auth_context` (Block List) (see [below for nested schema](#nestedblock--require--auth_context))
- `auth_method` (String) The type of authentication method. Refer to https://datatracker.ietf.org/doc/html/rfc8176#section-2 for possible types.
- `azure` (Block List) Matches an Azure group. Requires an Azure identity provider. (see [below for nested schema](#nestedblock--require--azure))
- `certificate` (Boolean) Matches any valid client certificate.
- `common_name` (String) Matches a valid client certificate common name.
- `common_names` (List of String) Overflow field if you need to have multiple common_name rules in a single policy.  Use in place of the singular common_name field.
- `device_posture` (List of String) The ID of a device posture integration.
- `email` (List of String) The email of the user.
- `email_domain` (List of String) The email domain to match.
- `email_list` (List of String) The ID of a previously created email list.
- `everyone` (Boolean) Matches everyone.
- `external_evaluation` (Block List) Create Allow or Block policies which evaluate the user based on custom criteria. https://developers.cloudflare.com/cloudflare-one/policies/access/external-evaluation/. (see [below for nested schema](#nestedblock--require--external_evaluation))
- `geo` (List of String) Matches a specific country.
- `github` (Block List) Matches a Github organization. Requires a Github identity provider. (see [below for nested schema](#nestedblock--require--github))
- `group` (List of String) The ID of a previously created Access group.
- `gsuite` (Block List) Matches a group in Google Workspace. Requires a Google Workspace identity provider. (see [below for nested schema](#nestedblock--require--gsuite))
- `ip` (List of String) An IPv4 or IPv6 CIDR block.
- `ip_list` (List of String) The ID of a previously created IP list.
- `login_method` (List of String) The ID of a configured identity provider.
- `okta` (Block List) Matches an Okta group. Requires an Okta identity provider. (see [below for nested schema](#nestedblock--require--okta))
- `saml` (Block List) Matches a SAML group. Requires a SAML identity provider. (see [below for nested schema](#nestedblock--require--saml))
- `service_token` (List of String) The ID of an Access service token.

<a id="nestedblock--require--auth_context"></a>
### Nested Schema for `require.auth_context`

Required:

- `ac_id` (String) The ACID of the Authentication Context.
- `id` (String) The ID of the Authentication Context.
- `identity_provider_id` (String) The ID of the Azure identity provider.


<a id="nestedblock--require--azure"></a>
### Nested Schema for `require.azure`

Optional:

- `id` (List of String) The ID of the Azure group or user.
- `identity_provider_id` (String) The ID of the Azure identity provider.


<a id="nestedblock--require--external_evaluation"></a>
### Nested Schema for `require.external_evaluation`

Optional:

- `evaluate_url` (String) The API endpoint containing your business logic.
- `keys_url` (String) The API endpoint containing the key that Access uses to verify that the response came from your API.


<a id="nestedblock--require--github"></a>
### Nested Schema for `require.github`

Optional:

- `identity_provider_id` (String) The ID of your Github identity provider.
- `name` (String) The name of the organization.
- `teams` (List of String) The teams that should be matched.


<a id="nestedblock--require--gsuite"></a>
### Nested Schema for `require.gsuite`

Required:

- `email` (List of String) The email of the Google Workspace group.
- `identity_provider_id` (String) The ID of your Google Workspace identity provider.


<a id="nestedblock--require--okta"></a>
### Nested Schema for `require.okta`

Optional:

- `identity_provider_id` (String) The ID of your Okta identity provider.
- `name` (List of String) The name of the Okta Group.


<a id="nestedblock--require--saml"></a>
### Nested Schema for `require.saml`

Optional:

- `attribute_name` (String) The name of the SAML attribute.
- `attribute_value` (String) The SAML attribute value to look for.
- `identity_provider_id` (String) The ID of your SAML identity provider.

## Import

Import is supported using the following syntax:

```shell
$ terraform import cloudflare_access_policy.example account/<account_id>/<application_id>/<policy_id>
```
